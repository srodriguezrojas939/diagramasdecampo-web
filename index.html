<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagrama de campo vectorial - Raiz Cuadrada</title>

    <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/nerdamer.core.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/Algebra.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/Calculus.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/Solve.js"></script>
    <script src="https://unpkg.com/d3@3/d3.min.js"></script>
    <script src="https://unpkg.com/function-plot/dist/function-plot.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap');

        .fade-in { opacity: 0; transform: translateY(25px); animation: fadeUp 0.9s ease forwards; }
        @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }

        body { background: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; font-family: 'Open Sans', sans-serif; }

        .calculadora-moderna {
            max-width: 650px; width: 100%; padding: 40px 30px;
            background: #F2F2F2; border-radius: 35px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            box-sizing: border-box;
        }

        .header-section { text-align: center; margin-bottom: 25px; }
        .header-section h1 { font-size: 28px; margin: 0; font-family: 'Playfair Display', serif; }
        .header-section p { font-size: 18px; font-weight: 600; color: #333; font-family: 'Playfair Display', serif; margin: 5px 0; }

        label { display: block; font-size: 11px; margin-bottom: 6px; margin-left: 12px; font-weight: 700; text-transform: uppercase; color: #666; letter-spacing: 0.5px; }

        .input-group { display: flex; gap: 10px; margin-bottom: 15px; align-items: center; }

        input[type="text"], input[type="number"] {
            font-size: 14px; padding: 12px 18px; border: 1px solid #ccc; border-radius: 25px;
            background: white; width: 100%; box-sizing: border-box; outline: none;
        }

        /* Estilo Color Picker Cuadrado */
        .color-picker-container {
            width: 45px; height: 45px; flex-shrink: 0; position: relative;
            border-radius: 12px; overflow: hidden; border: 2px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        input[type="color"] {
            position: absolute; top: -10px; left: -10px; width: 70px; height: 70px;
            cursor: pointer; border: none; padding: 0; background: none;
        }

        /* Sliders */
        input[type=range] { -webkit-appearance: none; background: transparent; padding: 0; border: none; width: 100%; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; cursor: pointer; background: #ddd; border-radius: 3px; }
        input[type=range]::-webkit-slider-thumb { height: 18px; width: 18px; border-radius: 50%; background: black; cursor: pointer; -webkit-appearance: none; margin-top: -6px; }

        .botones-container { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .boton-estilo {
            display: flex; align-items: center; justify-content: center;
            background: white; border: 1px solid #ccc; border-radius: 30px;
            padding: 12px; cursor: pointer; font-weight: 700; font-size: 13px; transition: 0.3s;
            color: black; text-decoration: none;
        }
        .boton-principal { background: black; color: white; border: none; }

        #contenedor-grafica {
            margin-top: 25px; background: white; border-radius: 25px;
            padding: 10px; border: 1px solid #ddd; overflow: hidden;
            display: flex; justify-content: center; position: relative;
        }
        #grafica { width: 100%; }
        #info-box { text-align: center; margin-top: 10px; font-size: 12px; color: #666; font-weight: 600; }

        /* PILLS NAVIGATION */
        .pills-nav-container {
            background: #e4e4e4; padding: 6px; border-radius: 40px;
            display: flex; justify-content: space-between; gap: 3px; margin-top: 25px;
            border: 1px solid #ccc;
        }
        .pill-btn {
            background: transparent; border: none; padding: 10px; border-radius: 30px;
            font-size: 11px; font-weight: 700; color: #666; cursor: pointer; 
            transition: 0.3s; flex: 1; text-transform: uppercase;
        }
        .pill-btn.active { background: white; color: black; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

        .tab-content { display: none; margin-top: 20px; }
        .tab-content.active { display: block; }

        .symbols-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }
        .sym-card {
            background: white; border-radius: 20px; padding: 15px 10px;
            text-align: center; cursor: pointer; transition: 0.2s;
            border: 1px solid #ccc; display: flex; flex-direction: column; min-height: 70px; justify-content: center;
        }
        .sym-card span { font-size: 13px; font-weight: 700; color: #000; }
        .sym-card small { font-size: 10px; color: #999; text-transform: uppercase; margin-top: 4px; }

        .guia-uso-container { background: white; border-radius: 25px; padding: 25px; color: #444; border: 1px solid #ccc; font-size: 14px; }
        .guia-uso-container h3 { font-family: 'Playfair Display', serif; margin-top: 0; }
        .code-box { background: #f8f8f8; padding: 10px; border-radius: 10px; font-family: monospace; font-size: 12px; margin: 10px 0; border-left: 3px solid black; }

        @media (max-width: 500px) { .header-section h1 { font-size: 22px; } .symbols-grid { grid-template-columns: 1fr 1fr; } }
    </style>
</head>
<body>

<div class="fade-in" style="width: 100%; display: flex; justify-content: center;">
    <div class="calculadora-moderna">
        <div class="header-section">
            <h1>Diagrama de campo vectorial</h1>
            <p>√(Raiz) Cuadrada²</p>
        </div>

        <div class="input-container">
            <label>Componente P(x, y) [Horizontal]</label>
            <div class="input-group">
                <input id="input-p" type="text" value="-y">
                <div class="color-picker-container">
                    <input type="color" id="color-start" value="#0000ff">
                </div>
            </div>
            
            <label>Componente Q(x, y) [Vertical]</label>
            <div class="input-group">
                <input id="input-q" type="text" value="x">
                <div class="color-picker-container">
                    <input type="color" id="color-end" value="#ff0000">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 10px;">
                <div>
                    <label>Densidad</label>
                    <input type="range" id="densidad" min="10" max="40" value="22" oninput="procesar()">
                </div>
                <div>
                    <label>Tamaño Flechas</label>
                    <input type="range" id="magnitud" min="0.1" max="2.0" step="0.1" value="0.8" oninput="procesar()">
                </div>
            </div>
        </div>

        <div class="botones-container">
            <button onclick="procesar()" class="boton-estilo boton-principal">Actualizar Campo</button>
            <button onclick="exportarImagen()" class="boton-estilo">
                <img src="https://cdn-icons-png.flaticon.com/512/724/724933.png" width="16" style="margin-right:8px"> 
                Descargar PNG
            </button>
        </div>

        <div id="contenedor-grafica">
            <div id="grafica"></div>
        </div>
        <div id="info-box">Colores interpolados por magnitud del vector</div>

        <div class="pills-nav-container">
            <button class="pill-btn active" onclick="showTab('ejemplos', this)">Ejemplos</button>
            <button class="pill-btn" onclick="showTab('tab-simbolos', this)">Simbolos</button>
            <button class="pill-btn" onclick="showTab('guia', this)">Guia</button>
        </div>

        <div id="ejemplos" class="tab-content active"><div class="symbols-grid" id="grid-ejemplos"></div></div>
        <div id="tab-simbolos" class="tab-content"><div class="symbols-grid" id="grid-simbolos"></div></div>
       <div id="guia" class="tab-content" style="line-height: 1.6; color: #333; background: white; border: 1px solid #ccc; padding: 40px; border-radius: 40px; text-align: left; margin-top: 20px;">
    
    <h2 style="font-family: 'Playfair Display', serif; font-size: 36px; margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 15px;">Guia de usos.</h2>
    
    <p>Esta herramienta permite representar magnitudes y direcciones de fuerzas en un plano bidimensional a través de vectores posicionados en una malla de coordenadas.</p>

    <h3 style="font-size: 24px; margin-top: 35px; font-weight: bold;">1. Componentes del Campo</h3>
    <p>Un campo vectorial asigna un vector <strong>F(x,y) = P i + Q j</strong> a cada punto del plano. Para graficarlo, debe definir el comportamiento de sus dos componentes principales:</p>
    
    <div style="border: 1px solid #ccc; border-radius: 15px; overflow: hidden; margin: 20px 0;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f8f8; border-bottom: 1px solid #ccc;">
                    <th style="padding: 12px; text-align: left; border-right: 1px solid #ccc;">Componente</th>
                    <th style="padding: 12px; text-align: left;">Descripción funcional</th>
                </tr>
            </thead>
            <tbody>
                <tr style="border-bottom: 1px solid #ccc;">
                    <td style="padding: 12px; border-right: 1px solid #ccc;"><strong>P (i)</strong></td>
                    <td style="padding: 12px;">Define la fuerza o desplazamiento en el eje <strong>Horizontal</strong>.</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border-right: 1px solid #ccc;"><strong>Q (j)</strong></td>
                    <td style="padding: 12px;">Define la fuerza o desplazamiento en el eje <strong>Vertical</strong>.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <h3 style="font-size: 24px; margin-top: 35px; font-weight: bold;">2. Sintaxis Matemática</h3>
    <p>Utilice las reglas de escritura estándar para que el motor procese las ecuaciones correctamente:</p>
    <ul>
        <li><strong>Potencias:</strong> Se representan con el símbolo <strong>^</strong> (ejemplo: x^2).</li>
        <li><strong>Multiplicación:</strong> Es obligatorio el uso del asterisco <strong>*</strong> (ejemplo: 2*x*y).</li>
        <li><strong>Variables permitidas:</strong> Utilice únicamente <strong>x</strong> y <strong>y</strong> en minúsculas.</li>
        <li><strong>Funciones:</strong> Puede usar comandos como <strong>sin()</strong>, <strong>cos()</strong>, <strong>exp()</strong>, <strong>sqrt()</strong>, <strong>abs()</strong> y <strong>log()</strong>.</li>
    </ul>

    <h3 style="font-size: 24px; margin-top: 35px; font-weight: bold;">3. Interpretación Visual y Colores</h3>
    <p>El sistema utiliza un código visual basado en la <strong>magnitud</strong> (largo) del vector:</p>
    <ul>
        <li><strong>Gradiente:</strong> El color de las flechas transita desde el primer selector de color hasta el segundo según la intensidad de la fuerza en ese punto.</li>
        <li><strong>Relación:</strong> Los vectores más cortos representan una magnitud menor (primer color), mientras que los más largos indican mayor fuerza (segundo color).</li>
    </ul>

    

    <h3 style="font-size: 24px; margin-top: 35px; font-weight: bold;">4. Control de la Visualización</h3>
    <p>Para analizar el comportamiento del flujo o campo de fuerzas, puede ajustar los siguientes parámetros:</p>
    <ul>
        <li><strong>Densidad:</strong> Controla la cantidad de flechas presentes en la cuadrícula.</li>
        <li><strong>Escala:</strong> Ajusta el tamaño visual de los vectores para evitar que se solapen entre sí.</li>
        <li><strong>Rango:</strong> Define el límite de los ejes X e Y para visualizar áreas específicas del plano.</li>
    </ul>

    <h3 style="font-size: 24px; margin-top: 35px; font-weight: bold;">5. Interacción con el Lienzo</h3>
    <ul>
        <li><strong>Navegación:</strong> Arrastre con el clic izquierdo para desplazarse por el plano de coordenadas.</li>
        <li><strong>Zoom:</strong> Utilice la rueda del ratón para acercar o alejar la vista.</li>
        <li><strong>Captura:</strong> El botón de "Descargar PNG" guardará una imagen de alta resolución de la configuración actual de su campo vectorial.</li>
    </ul>

    <div style="border: 1px solid #ccc; padding: 25px; border-radius: 20px; margin-top: 35px; background: #fafafa; font-style: italic;">
        <strong>Nota técnica:</strong>
        <p style="margin-top: 10px;">En física, este tipo de representaciones son esenciales para visualizar fenómenos como el flujo de fluidos, campos eléctricos o gradientes de temperatura. Experimente con funciones combinadas para observar puntos de convergencia (sumideros) o divergencia (fuentes).</p>
    </div>

</div>
    </div>
</div>

<canvas id="canvas-export" style="display:none;"></canvas>

<script>
const dataTabs = {
    ejemplos: [
        { s: '-y | x', t: 'VÓRTICE / ROTACIÓN' },
        { s: 'x | y', t: 'FUENTE / REPULSIÓN' },
        { s: '-x | -y', t: 'SUMIDERO / ATRACCIÓN' },
        { s: 'y | sin(x)', t: 'ONDAS DE CORTE' },
        { s: 'x-y | x+y', t: 'ESPIRAL EXPANSIVA' },
        { s: 'sin(y) | sin(x)', t: 'CAMPO PERIÓDICO' },
        { s: '1 | cos(x)', t: 'FLUJO UNIDIRECCIONAL' },
        { s: 'y | -x', t: 'ROTACIÓN HORARIA' }
    ],
    simbolos: [
        { s: '(', t: 'ABRIR' }, { s: ')', t: 'CERRAR' }, { s: '+', t: 'SUMA' }, { s: '-', t: 'RESTA' },
        { s: '*', t: 'MULT.' }, { s: '/', t: 'DIV.' }, { s: '^', t: 'POTENCIA' }, { s: 'sqrt()', t: 'RAÍZ' },
        { s: 'x', t: 'VAR X' }, { s: 'y', t: 'VAR Y' }, { s: 'pi', t: 'PI' }, { s: 'e', t: 'EULER' }
    ]
};

function renderGrids() {
    document.getElementById('grid-ejemplos').innerHTML = dataTabs.ejemplos.map(item => `
        <div class="sym-card" onclick="aplicarEjemplo('${item.s}')">
            <span>${item.s}</span>
            <small>${item.t}</small>
        </div>
    `).join('');

    document.getElementById('grid-simbolos').innerHTML = dataTabs.simbolos.map(item => `
        <div class="sym-card" onclick="insertarSimbolo('${item.s}')">
            <span>${item.s}</span>
            <small>${item.t}</small>
        </div>
    `).join('');
}

function aplicarEjemplo(val) {
    const [p, q] = val.split(' | ');
    document.getElementById('input-p').value = p.trim();
    document.getElementById('input-q').value = q.trim();
    procesar();
}

function insertarSimbolo(val) {
    const input = document.activeElement.tagName === 'INPUT' ? document.activeElement : document.getElementById('input-p');
    input.value += val;
    input.focus();
}

function showTab(id, btn) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.pill-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    btn.classList.add('active');
}

function hexToRgb(hex) {
    const r = parseInt(hex.slice(1,3), 16), g = parseInt(hex.slice(3,5), 16), b = parseInt(hex.slice(5,7), 16);
    return {r, g, b};
}

function interpolarColor(c1, c2, valor) {
    const p = Math.max(0, Math.min(1, valor));
    const r = Math.round(c1.r + (c2.r - c1.r) * p);
    const g = Math.round(c1.g + (c2.g - c1.g) * p);
    const b = Math.round(c1.b + (c2.b - c1.b) * p);
    return `rgb(${r},${g},${b})`;
}

window.onload = () => { renderGrids(); procesar(); };
window.addEventListener('resize', procesar);

function procesar() {
    const pExpr = document.getElementById('input-p').value;
    const qExpr = document.getElementById('input-q').value;
    const nSteps = parseInt(document.getElementById('densidad').value);
    const mScale = parseFloat(document.getElementById('magnitud').value);
    const colorStart = hexToRgb(document.getElementById('color-start').value);
    const colorEnd = hexToRgb(document.getElementById('color-end').value);
    
    document.getElementById('grafica').innerHTML = "";
    const width = document.getElementById('contenedor-grafica').offsetWidth - 20;

    try {
        let vectorData = [];
        const range = 10;
        const stepSize = (range * 2) / nSteps;
        let calculos = [];

        for (let i = -range; i <= range; i += stepSize) {
            for (let j = -range; j <= range; j += stepSize) {
                try {
                    let vx = parseFloat(nerdamer(pExpr).evaluate({x: i, y: j}).toString());
                    let vy = parseFloat(nerdamer(qExpr).evaluate({x: i, y: j}).toString());
                    let mag = Math.sqrt(vx*vx + vy*vy);
                    if(!isNaN(mag)) calculos.push({i, j, vx, vy, mag});
                } catch(e){}
            }
        }

        const maxMag = Math.max(...calculos.map(c => c.mag)) || 1;

        calculos.forEach(p => {
            const nvx = (p.vx / (p.mag + 0.001)) * mScale;
            const nvy = (p.vy / (p.mag + 0.001)) * mScale;
            const color = interpolarColor(colorStart, colorEnd, p.mag / maxMag);
            
            const xF = p.i + nvx, yF = p.j + nvy;
            const angle = Math.atan2(nvy, nvx);
            const pL = mScale * 0.35;
            const p1x = xF - pL * Math.cos(angle - 0.5), p1y = yF - pL * Math.sin(angle - 0.5);
            const p2x = xF - pL * Math.cos(angle + 0.5), p2y = yF - pL * Math.sin(angle + 0.5);

            vectorData.push({
                points: [[p.i, p.j], [xF, yF], [p1x, p1y], [xF, yF], [p2x, p2y]],
                fnType: 'points', graphType: 'polyline', color: color, attr: { 'stroke-width': 1.8 }
            });
        });

        functionPlot({
            target: "#grafica", width: width, height: width * 0.8,
            grid: true, xAxis: { domain: [-11, 11] }, yAxis: { domain: [-9, 9] },
            data: vectorData
        });
    } catch (e) { console.error(e); }
}

function exportarImagen() {
    const svgElement = document.querySelector('#grafica svg');
    const canvas = document.getElementById('canvas-export');
    const ctx = canvas.getContext('2d');
    const svgData = new XMLSerializer().serializeToString(svgElement);
    const img = new Image();
    const svgSize = svgElement.getBoundingClientRect();
    canvas.width = svgSize.width * 2; canvas.height = svgSize.height * 2;
    img.onload = function() {
        ctx.fillStyle = "white"; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        ctx.font = "bold 42px 'Playfair Display'"; ctx.fillStyle = "rgba(0,0,0,0.3)";
        ctx.textAlign = "right"; ctx.fillText("√(Raiz) Cuadrada²", canvas.width - 50, canvas.height - 50);
        const link = document.createElement('a');
        link.download = 'campo-vectorial-raiz-cuadrada.png';
        link.href = canvas.toDataURL('image/png'); link.click();
    };
    img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));
}
</script>
</body>
</html>
